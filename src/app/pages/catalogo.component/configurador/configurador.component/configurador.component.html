<div class="min-h-screen bg-base-200 py-8">
  <div class="container mx-auto px-4">

    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-primary mb-2">Personaliza tu Tarta</h1>
      <p class="text-base-content/70">Crea la tarta perfecta para tu ocasi√≥n especial</p>
    </div>

    <div class="grid lg:grid-cols-3 gap-6">

      <div class="lg:col-span-2 space-y-6">
<!--  1: Elige Bizcoxho -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
              <span class="badge badge-primary badge-lg">1</span>
              Elige tu Bizcocho Base
            </h2>

            <div class="grid sm:grid-cols-2 gap-4">
              @for (b of bizcochos(); track b.id) {
                <div
                  (click)="onSeleccionarBizcocho(b.id)"
                  class="card bg-base-200 cursor-pointer transition hover:shadow-xl border-2"
                  [class.border-primary]="bizcochoSeleccionado()?.id === b.id"
                  [class.border-transparent]="bizcochoSeleccionado()?.id !== b.id">
                  <div class="card-body p-4">
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h3 class="font-semibold text-lg">{{ b.nombre }}</h3>
                      </div>
                      <div class="text-right ml-2">
                        <p class="font-bold text-primary">+{{ b.precioAdicional }}‚Ç¨</p>
                        @if (bizcochoSeleccionado()?.id === b.id) {
                          <span class="badge badge-primary badge-sm mt-1">‚úì</span>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>

        <!--  2: Relleno -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
              <span class="badge badge-primary badge-lg">2</span>
              Selecciona el Relleno
            </h2>

            <div class="grid sm:grid-cols-3 gap-3">
              @for (r of rellenos(); track r.id) {
                <div
                  (click)="onSeleccionarRelleno(r.id)"
                  class="card bg-base-200 cursor-pointer transition hover:shadow-lg border-2 compact"
                  [class.border-primary]="rellenoSeleccionado()?.id === r.id"
                  [class.border-transparent]="rellenoSeleccionado()?.id !== r.id">
                  <div class="card-body p-3 text-center">
                    <div class="text-3xl mb-1">üçì</div>
                    <h3 class="font-semibold text-sm">{{ r.nombre }}</h3>
                    <p class="text-primary font-bold text-xs">+{{ r.precioAdicional }}‚Ç¨</p>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>

        <!--3: Cobertura -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
              <span class="badge badge-primary badge-lg">3</span>
              Elige la Cobertura
            </h2>

            <div class="grid sm:grid-cols-3 gap-3">
              @for (c of coberturas(); track c.id) {
                <div
                  (click)="onSeleccionarCobertura(c.id)"
                  class="card bg-base-200 cursor-pointer transition hover:shadow-lg border-2 compact"
                  [class.border-primary]="coberturaSeleccionada()?.id === c.id"
                  [class.border-transparent]="coberturaSeleccionada()?.id !== c.id">
                  <div class="card-body p-3 text-center">
                    <div class="text-3xl mb-1">üç´</div>
                    <h3 class="font-semibold text-sm">{{ c.nombre }}</h3>
                    <p class="text-primary font-bold text-xs">+{{ c.precioAdicional }}‚Ç¨</p>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- 4: Tama√±o y Pisos -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
              <span class="badge badge-primary badge-lg">4</span>
              Tama√±o y Pisos
            </h2>

            <div class="grid md:grid-cols-1 gap-6">
              <!-- Tama√±o -->
              <div>
                <label class="label">
                  <span class="label-text font-semibold mb-1">Tama√±o (personas)</span>
                </label>
                <div class="flex gap-2">
                  @for (tam of tamanos(); track tam.personas) {
                    <button
                      (click)="onSeleccionarTamano(tam.personas)"
                      class="btn flex-1"
                      [class.btn-primary]="tamanoSeleccionado() === tam.personas"
                      [class.btn-outline]="tamanoSeleccionado() !== tam.personas">
                      {{ tam.personas }}
                      <span class="text-xs opacity-70">+{{ tam.precioAdicional }}‚Ç¨</span>
                    </button>
                  }
                </div>
              </div>

              <!-- Pisos -->
              <div>
                <label class="label">
                  <span class="label-text font-semibold mb-1">N√∫mero de Pisos</span>
                </label>
                <div class="flex gap-2">
                  @for (p of [1, 2, 3]; track p) {
                    <button
                      (click)="onSeleccionarPisos(p)"
                      class="btn flex-1"
                      [class.btn-primary]="pisosSeleccionados() === p"
                      [class.btn-outline]="pisosSeleccionados() !== p">
                      {{ p }} {{ p === 1 ? 'piso' : 'pisos' }}
                      <span class="text-xs opacity-70">+{{ (p - 1) * 15 }}‚Ç¨</span>
                    </button>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 5: Extras -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
              <span class="badge badge-primary badge-lg">5</span>
              Extras y Decoraci√≥n
            </h2>

            <div class="space-y-3">
              @for (extra of extras(); track extra.id) {
                <label class="flex items-center gap-3 p-3 bg-base-200 rounded-lg cursor-pointer hover:bg-base-300 transition">
                  <input
                    type="checkbox"
                    class="checkbox checkbox-primary"
                    [checked]="extrasSeleccionados().includes(extra.id)"
                    (change)="onToggleExtra(extra.id)" />
                  <div class="flex-1">
                    <span class="font-semibold">{{ extra.nombre }}</span>
                  </div>
                  <span class="font-bold text-primary">+{{ extra.precioAdicional }}‚Ç¨</span>
                </label>
              }
            </div>
          </div>
        </div>

        <!-- PASO 6: Personalizaci√≥n -->
        <div class="card bg-base-100 shadow-lg">
          <div class="card-body">
            <h2 class="card-title text-2xl mb-4">
              <span class="badge badge-primary badge-lg">6</span>
              Personalizaci√≥n
            </h2>

            <div class="space-y-4">
              <!-- Mensaje en la tarta -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold mb-2">Mensaje en la tarta (opcional)</span>
                  <span class="label-text-alt">M√°x. 30 caracteres</span>
                </label>
                <input
                  type="text"
                  placeholder="Ej: Feliz Cumplea√±os Mar√≠a"
                  class="input input-bordered w-full mb-2"
                  maxlength="30"
                  [(ngModel)]="mensajeTarta"
                  (ngModelChange)="actualizarPrecio()" />
                <label class="label">
                  <span class="label-text-alt text-base-content/60">{{ mensajeTarta().length }}/30</span>
                </label>
              </div>

              <!-- Ingredientes adicionales -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold mr-3">Ingredientes adicionales (opcional)</span>
                </label>
                <textarea
                  class="textarea textarea-bordered h-20"
                  placeholder="Ej: Fresas frescas, chocolate blanco rallado..."
                  [(ngModel)]="ingredientesExtra"
                  (ngModelChange)="actualizarPrecio()"></textarea>
              </div>

              <!-- Alergias e intolerancias -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold mr-3">Alergias o intolerancias (opcional)</span>
                </label>
                <textarea
                  class="textarea textarea-bordered h-20"
                  placeholder="Ej: Sin lactosa, sin gluten, sin frutos secos..."
                  [(ngModel)]="alergias"
                  (ngModelChange)="actualizarPrecio()"></textarea>
              </div>

              <!-- Comentarios adicionales -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text font-semibold mr-3">Comentarios adicionales</span>
                </label>
                <textarea
                  class="textarea textarea-bordered h-24"
                  placeholder="Cualquier petici√≥n especial o detalle que quieras comentarnos..."
                  [(ngModel)]="comentarios"
                  (ngModelChange)="actualizarPrecio()"></textarea>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- COLUMNA DERECHA: Resumen y Precio (1/3) -->
      <div class="lg:col-span-1">
        <div class="sticky top-4 space-y-4">

          <!-- Card de Resumen -->
          <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
              <h3 class="card-title text-xl mb-4">Resumen del Pedido</h3>

              <div class="space-y-3 text-sm">
                <!-- Bizcocho -->
                @if (bizcochoSeleccionado()) {
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-semibold">Bizcocho</p>
                      <p class="text-xs text-base-content/70">{{ bizcochoSeleccionado()?.nombre }}</p>
                    </div>
                    <span class="font-semibold">{{ bizcochoSeleccionado()?.precioAdicional }}‚Ç¨</span>
                  </div>
                  <div class="divider my-2"></div>
                }

                <!-- Relleno -->
                @if (rellenoSeleccionado()) {
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-semibold">Relleno</p>
                      <p class="text-xs text-base-content/70">{{ rellenoSeleccionado()?.nombre }}</p>
                    </div>
                    <span class="font-semibold">{{ rellenoSeleccionado()?.precioAdicional }}‚Ç¨</span>
                  </div>
                  <div class="divider my-2"></div>
                }

                <!-- Cobertura -->
                @if (coberturaSeleccionada()) {
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-semibold">Cobertura</p>
                      <p class="text-xs text-base-content/70">{{ coberturaSeleccionada()?.nombre }}</p>
                    </div>
                    <span class="font-semibold">{{ coberturaSeleccionada()?.precioAdicional }}‚Ç¨</span>
                  </div>
                  <div class="divider my-2"></div>
                }

                <!-- Tama√±o -->
                @if (tamanoSeleccionado()) {
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-semibold">Tama√±o</p>
                      <p class="text-xs text-base-content/70">{{ tamanoSeleccionado() }} personas</p>
                    </div>
                    <span class="font-semibold">{{ obtenerPrecioTamano() }}‚Ç¨</span>
                  </div>
                  <div class="divider my-2"></div>
                }

                <!-- Pisos -->
                @if (pisosSeleccionados() > 1) {
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-semibold">Pisos adicionales</p>
                      <p class="text-xs text-base-content/70">{{ pisosSeleccionados() - 1 }} piso(s)</p>
                    </div>
                    <span class="font-semibold">{{ (pisosSeleccionados() - 1) * 15 }}‚Ç¨</span>
                  </div>
                  <div class="divider my-2"></div>
                }

                <!-- Extras -->
                @if (extrasSeleccionados().length > 0) {
                  <div>
                    <p class="font-semibold mb-2">Extras</p>
                    @for (extraId of extrasSeleccionados(); track extraId) {
                      <div class="flex justify-between items-center text-xs mb-1">
                        <span class="text-base-content/70">‚Ä¢ {{ obtenerNombreExtra(extraId) }}</span>
                        <span class="font-semibold">{{ obtenerPrecioExtra(extraId) }}‚Ç¨</span>
                      </div>
                    }
                  </div>
                  <div class="divider my-2"></div>
                }

                <!-- Mensaje personalizado -->
                @if (mensajeTarta().length > 0) {
                  <div class="flex justify-between items-start">
                    <div>
                      <p class="font-semibold">Mensaje</p>
                      <p class="text-xs text-base-content/70">"{{ mensajeTarta() }}"</p>
                    </div>
                    <span class="font-semibold">Gratis</span>
                  </div>
                  <div class="divider my-2"></div>
                }
              </div>

              <!-- Precio Total -->
              <div class="bg-primary/10 rounded-lg p-4 mt-4">
                <div class="flex justify-between items-center">
                  <span class="text-lg font-bold">Total</span>
                  <span class="text-3xl font-bold text-primary">{{ precioFinal() | number:'1.2-2' }}‚Ç¨</span>
                </div>
              </div>

              <!-- Bot√≥n de compra -->
              <button
                class="btn btn-primary btn-lg w-full mt-4"
                [disabled]="!esConfiguracionValida()"
                (click)="realizarPedido()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                A√±adir al carrito
              </button>

              @if (!esConfiguracionValida()) {
                <div class="alert alert-warning mt-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-5 w-5" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                  <span class="text-xs">Selecciona al menos bizcocho, relleno y cobertura</span>
                </div>
              }
            </div>
          </div>

          <div class="card bg-base-100 shadow-lg">
            <div class="card-body p-4">
              <div class="flex items-start gap-3">
                <div class="text-2xl">üöö</div>
                <div class="text-sm">
                  <p class="font-semibold mb-1">Entrega en 24-48h</p>
                  <p class="text-base-content/70">Recogida en tienda gratuita</p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
